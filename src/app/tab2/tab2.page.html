<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>My Plan</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="ion-padding">
    <ion-card>
      <ion-card-header>
        <ion-card-title>Your healing plan</ion-card-title>
      </ion-card-header>

      <ion-card-content>
        <ion-text color="medium">
          <p>
            Answer these quickly so I can create meals that support your hormones, digestion and inflammation ğŸ’›
          </p>
        </ion-text>

        <!-- Eating style -->
        <h2 class="section-title">ğŸ•’ Eating style</h2>

        <ion-item>
          <ion-label>Fasting style</ion-label>
          <ion-select
            interface="popover"
            [value]="fastingStyle()"
            (ionChange)="fastingStyle.set($event.detail.value)"
          >
            <ion-select-option value="NO_FASTING_3_MEALS">No fasting Â· 3 meals</ion-select-option>
            <ion-select-option value="FASTING_16_8">16:8 fasting</ion-select-option>
            <ion-select-option value="FASTING_18_6">18:6 fasting</ion-select-option>
          </ion-select>
        </ion-item>

        <div class="range-block">
        <ion-range
  min="8"
  max="14"
  step="1"
  [value]="firstMealHour()"
  (ionChange)="onFirstMealHourChange($event.detail.value)"
>
  <ion-label slot="end">{{ firstMealHour() }}</ion-label>
</ion-range>


          <ion-text color="medium">
            <p class="helper-text">Breakfast, lunch and dinner spread through the day.</p>
          </ion-text>
        </div>

        <!-- Focus areas -->
        <h2 class="section-title">ğŸ¯ Focus areas</h2>

        <ion-list lines="none">
          <ion-item>
            <ion-checkbox
              slot="start"
              [checked]="fibroidFocus()"
              (ionChange)="fibroidFocus.set($event.detail.checked)"
            ></ion-checkbox>
            <ion-label>Support fibroids with fibre &amp; cruciferous veggies</ion-label>
          </ion-item>

          <ion-item>
            <ion-checkbox
              slot="start"
              [checked]="ironSupport()"
              (ionChange)="ironSupport.set($event.detail.checked)"
            ></ion-checkbox>
            <ion-label>Support iron levels (for heavy periods / low iron)</ion-label>
          </ion-item>
        </ion-list>

        <!-- Plan duration (NOT tabs) -->
        <h2 class="section-title">ğŸ“… Plan duration</h2>

        <ion-segment
          [value]="duration()"
          (ionChange)="setDuration($event.detail.value ?? duration())"
        >
          <ion-segment-button value="7">
            <ion-label>Weekly</ion-label>
          </ion-segment-button>

          <ion-segment-button value="14">
            <ion-label>Biweekly</ion-label>
          </ion-segment-button>

          <ion-segment-button value="30">
            <ion-label>Monthly</ion-label>
          </ion-segment-button>
        </ion-segment>

        <div class="spacer"></div>

        <ion-button expand="block" (click)="generatePlan()">
          âœ¨ Generate My Healing Plan
        </ion-button>

<!-- <ng-container *ngIf="mealPlanResponse() as plan">
  <ion-list>
    <ion-item-divider>
      <ion-label>Meal plan ({{ plan.days }} days)</ion-label>
    </ion-item-divider>

    <ng-container *ngFor="let day of plan.daysPlan">
      <ion-item-divider>
        <ion-label>{{ day.date }}</ion-label>
      </ion-item-divider>

      <ion-item *ngFor="let m of day.meals">
        <ion-label>
          <h3>{{ m.mealType }}</h3>
          <p>{{ m.name }}</p>
        </ion-label>
      </ion-item>

      <ion-item *ngIf="!day.meals || day.meals.length === 0">
        <ion-label>No meals for this day</ion-label>
      </ion-item>
    </ng-container>
  </ion-list>
</ng-container> -->

      </ion-card-content>
    </ion-card>

    <!-- Placeholder f<h2 class="section-title">ğŸŒ Todayâ€™s meals</h2>or "Today's meals" + "View full plan" section (weâ€™ll wire to API next) -->

<!-- âœ… TODAY'S MEALS -->
<ion-card *ngIf="todayDay() as day; else noTodayCard">
  <ion-card-header>
    <ion-card-title>ğŸŒ Todayâ€™s meals</ion-card-title>
  </ion-card-header>

  <ion-card-content>
    <ion-list>
      <ion-item *ngFor="let meal of day.meals">
        <ion-label>
          <div style="font-weight: 700;">{{ meal.name }}</div>
          <div style="opacity: 0.7; font-size: 0.9rem;">{{ meal.mealType }}</div>
        </ion-label>

        <!-- Optional: keep it simple for now. We'll wire navigation next -->
        <ion-button fill="clear" slot="end" (click)="openMealDetails(meal.mealId)">ğŸ‘©ğŸ½â€ğŸ³ See full recipe</ion-button>
      </ion-item>
    </ion-list>
  </ion-card-content>
</ion-card>

<ng-template #noTodayCard>
  <ion-card>
    <ion-card-header>
      <ion-card-title>ğŸŒ Todayâ€™s meals</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-text>
        Your plan doesnâ€™t start today, but you can still view all days below.
      </ion-text>
    </ion-card-content>
  </ion-card>
</ng-template>


  <ion-text *ngIf="shouldShowStartNotice()">
  <p class="start-notice">
    Your plan doesnâ€™t start today, but you can still view all days below.
  </p>
</ion-text>


   <!-- âœ… VIEW FULL PLAN (ALL DAYS) -->
<!-- View full plan (all days) -->
<ion-accordion-group [value]="fullPlanOpen() ? 'fullPlan' : undefined">

  <ion-accordion value="fullPlan">

    <!-- Header row (the clickable bar) -->
    <ion-item slot="header" button detail="false" (click)="toggleFullPlan()">
      <ion-label>ğŸ“… View full plan (all days)</ion-label>
    </ion-item>

    <!-- Content (collapsible) -->
    <div slot="content">
      <ion-list *ngIf="mealPlanResponse() as plan">

        <div *ngFor="let day of plan.daysPlan">
          <ion-item-divider>
            <ion-label>{{ day.date }}</ion-label>
          </ion-item-divider>

          <ion-item *ngFor="let meal of day.meals">
            <ion-label>
              <div style="font-weight:600">{{ meal.mealType }}</div>
              <div>{{ meal.name }}</div>
            </ion-label>

            <!-- keep your recipe nav if you already wired it -->
            <ion-button
              slot="end"
              fill="clear"
              (click)="openMeal(meal.mealId); $event.stopPropagation()">
              ğŸ‘©â€ğŸ³ See full recipe
            </ion-button>
          </ion-item>
        </div>

      </ion-list>
    </div>

  </ion-accordion>

</ion-accordion-group>


  </div>
</ion-content>
